(function(e){function t(t){for(var s,o,i=t[0],u=t[1],l=t[2],d=0,m=[];d<i.length;d++)o=i[d],Object.prototype.hasOwnProperty.call(n,o)&&n[o]&&m.push(n[o][0]),n[o]=0;for(s in u)Object.prototype.hasOwnProperty.call(u,s)&&(e[s]=u[s]);c&&c(t);while(m.length)m.shift()();return a.push.apply(a,l||[]),r()}function r(){for(var e,t=0;t<a.length;t++){for(var r=a[t],s=!0,i=1;i<r.length;i++){var u=r[i];0!==n[u]&&(s=!1)}s&&(a.splice(t--,1),e=o(o.s=r[0]))}return e}var s={},n={app:0},a=[];function o(t){if(s[t])return s[t].exports;var r=s[t]={i:t,l:!1,exports:{}};return e[t].call(r.exports,r,r.exports,o),r.l=!0,r.exports}o.m=e,o.c=s,o.d=function(e,t,r){o.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:r})},o.r=function(e){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},o.t=function(e,t){if(1&t&&(e=o(e)),8&t)return e;if(4&t&&"object"===typeof e&&e&&e.__esModule)return e;var r=Object.create(null);if(o.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var s in e)o.d(r,s,function(t){return e[t]}.bind(null,s));return r},o.n=function(e){var t=e&&e.__esModule?function(){return e["default"]}:function(){return e};return o.d(t,"a",t),t},o.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},o.p="/";var i=window["webpackJsonp"]=window["webpackJsonp"]||[],u=i.push.bind(i);i.push=t,i=i.slice();for(var l=0;l<i.length;l++)t(i[l]);var c=u;a.push([0,"chunk-vendors"]),r()})({0:function(e,t,r){e.exports=r("56d7")},1:function(e,t){},10:function(e,t){},11:function(e,t){},12:function(e,t){},13:function(e,t){},14:function(e,t){},15:function(e,t){},2:function(e,t){},"25d8":function(e,t,r){},3:function(e,t){},4:function(e,t){},5:function(e,t){},"56d7":function(e,t,r){"use strict";r.r(t);r("cadf"),r("551c"),r("f751"),r("097d");var s=r("2b0e"),n=function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("div",{attrs:{id:"app"}},[e.currentUser?r("nav",{staticClass:"navbar navbar-expand navbar-dark bg-dark"},[r("div",{staticClass:"navbar-nav"},[r("router-link",{staticClass:"nav-item nav-link",attrs:{to:"/"}},[e._v("Dashboard")]),e.isAuditor?r("router-link",{staticClass:"nav-item nav-link",attrs:{to:"/allocated"}},[e._v("\n        Allocated\n      ")]):e._e(),e.isMember?r("router-link",{staticClass:"nav-item nav-link",attrs:{to:"/stats"}},[e._v("\n        Stats\n      ")]):e._e(),r("a",{staticClass:"nav-item nav-link",on:{click:e.logout}},[e._v("Logout")])],1)]):e._e(),r("div",{staticClass:"jumbotron"},[r("div",{staticClass:"container"},[r("div",{staticClass:"row"},[r("div",{staticClass:"col-sm-6 offset-sm-3"},[r("router-view")],1)])])])])},a=[],o=r("dba1"),i=(r("8e6e"),r("ac6a"),r("456d"),r("bd86"));function u(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);t&&(s=s.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,s)}return r}function l(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?u(Object(r),!0).forEach((function(t){Object(i["a"])(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):u(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}var c={get:function(){return l({method:"GET"},d())},post:function(e){return l(l({method:"POST"},d()),{},{body:JSON.stringify(e)})},patch:function(e){return l(l({method:"PATCH"},d()),{},{body:JSON.stringify(e)})},put:function(e){return l(l({method:"PUT"},d()),{},{body:JSON.stringify(e)})},delete:function(){return l({method:"DELETE"},d())}};function d(){var e=v.currentUserValue||{},t=e.token?{Authorization:"Bearer "+e.token}:{};return{headers:l(l({},t),{},{"Content-Type":"application/json"})}}function m(e){return e.text().then((function(t){var r=t&&JSON.parse(t);if(!e.ok){-1!==[401,403].indexOf(e.status)&&(v.logout(),location.reload(!0));var s=r&&r.message||e.statusText;return Promise.reject(s)}return r}))}var p=r("7dc8"),f=p.API_URL,g=new o["a"](JSON.parse(localStorage.getItem("currentUser"))),v={login:h,logout:b,currentUser:g.asObservable(),get currentUserValue(){return g.value}};function h(e){return fetch("".concat(f,"/signin"),c.post(e)).then(m).then((function(e){return localStorage.setItem("currentUser",JSON.stringify(e)),g.next(e),e}))}function b(){localStorage.removeItem("currentUser"),g.next(null)}var w={MEMBER:"Member",AUDITOR:"Auditor"},y=w,_=(r("7f7f"),r("6762"),r("2fdb"),r("8c4f")),O=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("section",[s("h1",[e._v("Signup")]),e.signingUp?s("div",[s("img",{attrs:{src:r("5c3d")}})]):e._e(),e.errorMessage?s("div",{staticClass:"alert alert-danger",attrs:{role:"alert"}},[e._v(e._s(e.errorMessage))]):e._e(),s("div",{staticClass:"container"},[s("div",{staticClass:"row"},[s("div",{staticClass:"col-lg=3 col-md-2 col-sm-1 col-xs-12"}),s("div",{staticClass:"col-lg=6 col-md-8 col-sm-10 col-xs-12"},[e.signingUp?e._e():s("form",{on:{submit:function(t){return t.preventDefault(),e.signup(t)}}},[s("div",{staticClass:"form-group"},[s("label",{attrs:{for:"name"}},[e._v("Name")]),s("input",{directives:[{name:"model",rawName:"v-model",value:e.user.name,expression:"user.name"}],staticClass:"form-control",attrs:{type:"text",id:"name","aria-describedby":"nameHelp",required:""},domProps:{value:e.user.name},on:{input:function(t){t.target.composing||e.$set(e.user,"name",t.target.value)}}})]),s("div",{staticClass:"form-group"},[s("label",{attrs:{for:"email"}},[e._v("Email")]),s("input",{directives:[{name:"model",rawName:"v-model",value:e.user.email,expression:"user.email"}],staticClass:"form-control",attrs:{type:"text",id:"email","aria-describedby":"emailHelp",required:""},domProps:{value:e.user.email},on:{input:function(t){t.target.composing||e.$set(e.user,"email",t.target.value)}}})]),s("div",{staticClass:"form-row"},[s("div",{staticClass:"form-group col-md-6"},[s("label",{attrs:{for:"password"}},[e._v("Password")]),s("input",{directives:[{name:"model",rawName:"v-model",value:e.user.password,expression:"user.password"}],staticClass:"form-control",attrs:{type:"password",id:"password","aria-describedby":"passwordHelp",required:""},domProps:{value:e.user.password},on:{input:function(t){t.target.composing||e.$set(e.user,"password",t.target.value)}}})]),s("div",{staticClass:"form-group col-md-6"},[s("label",{attrs:{for:"confirmPassword"}},[e._v("Confirm Password")]),s("input",{directives:[{name:"model",rawName:"v-model",value:e.user.confirmPassword,expression:"user.confirmPassword"}],staticClass:"form-control",attrs:{type:"password",id:"confirmPassword","aria-describedby":"confirmPasswordHelp",required:""},domProps:{value:e.user.confirmPassword},on:{input:function(t){t.target.composing||e.$set(e.user,"confirmPassword",t.target.value)}}})])]),s("button",{staticClass:"btn btn-primary",attrs:{type:"submit"}},[e._v("Signup")])]),s("div",{staticClass:"mt-3"},[s("router-link",{attrs:{to:"/signin"}},[e._v("I am already a member")])],1)])]),s("div",{staticClass:"col-lg=3 col-md-2 col-sm-1 col-xs-12"})])])},P=[],C=r("f0b1"),x=r.n(C),j=r("7dc8"),U=j.API_URL,M=U+"/signup",k={data:function(){return{signingUp:!1,errorMessage:"",user:{email:"",password:"",confirmPassword:"",name:""}}},watch:{user:{handler:function(){this.errorMessage=""},deep:!0}},methods:{signup:function(){var e=this;if(this.errorMessage="",this.validUser()){var t={email:this.user.email,password:this.user.password,name:this.user.name};this.signingUp=!0,fetch(M,{method:"POST",body:JSON.stringify(t),headers:{"content-type":"application/json"}}).then((function(e){return e.ok?e.json():e.json().then((function(e){throw new Error(e.error)}))})).then((function(t){localStorage.token=t.token,e.signingUp=!1,e.$router.push("/dashboard")})).catch((function(t){e.signingUp=!1,e.errorMessage=t.message}))}},validUser:function(){var e=x.a.object().keys({email:x.a.string().email().required(),password:x.a.string().regex(/^[a-zA-Z0-9]{5,30}$/).required(),confirmPassword:x.a.string().regex(/^[a-zA-Z0-9]{5,30}$/).required(),name:x.a.string().min(3).max(30).required()});if(this.user.password!==this.user.confirmPassword)return this.errorMessage="Passwords must match.",!1;var t=x.a.validate(this.user,e);return null===t.error||(t.error.message.includes("name")?(this.errorMessage="bad length or format of a name",!1):(t.error.message.includes("email")?this.errorMessage="email is invalid.":this.errorMessage="Password is invalid.",!1))}}},S=k,E=r("2877"),$=Object(E["a"])(S,O,P,!1,null,null,null),A=($.exports,function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("section",[s("h1",[e._v("Sign in with")]),e.loggingIn?s("div",[s("img",{attrs:{src:r("5c3d")}})]):e._e(),e.errorMessage?s("div",{staticClass:"alert alert-danger",attrs:{role:"alert"}},[e._v("\n    "+e._s(e._f("filtermessage")(e.errorMessage))+"\n  ")]):e._e(),e.loggingIn?e._e():s("div",{staticClass:"container"},[s("div",{staticClass:"row"},[s("div",{staticClass:"col-lg=3 col-md-2 col-sm-1 col-xs-12"}),s("div",{staticClass:"col-lg=6 col-md-8 col-sm-10 col-xs-12"},[s("form",{staticClass:"mt-2",on:{submit:function(t){return t.preventDefault(),e.signin()}}},[s("div",{staticClass:"form-group"},[s("label",{attrs:{for:"email"}},[e._v("Email")]),s("input",{directives:[{name:"model",rawName:"v-model",value:e.user.email,expression:"user.email"}],staticClass:"form-control",attrs:{type:"text",id:"email","aria-describedby":"emailHelp",required:""},domProps:{value:e.user.email},on:{input:function(t){t.target.composing||e.$set(e.user,"email",t.target.value)}}})]),s("div",{staticClass:"form-group"},[s("label",{attrs:{for:"password"}},[e._v("Password")]),s("input",{directives:[{name:"model",rawName:"v-model",value:e.user.password,expression:"user.password"}],staticClass:"form-control",attrs:{type:"password",id:"password","aria-describedby":"passwordHelp",required:""},domProps:{value:e.user.password},on:{input:function(t){t.target.composing||e.$set(e.user,"password",t.target.value)}}})]),s("button",{staticClass:"btn btn-primary",attrs:{type:"submit"}},[e._v("Signin")])]),s("br"),s("div",[e._v("\n          Donâ€™t have an account?\n          "),s("router-link",{attrs:{to:"/signup"}},[e._v("Sign up")])],1)]),s("div",{staticClass:"col-lg=3 col-md-2 col-sm-1 col-xs-12"})])])])}),I=[],N=x.a.object().keys({email:x.a.string().email().required(),password:x.a.string().regex(/^[a-zA-Z0-9]{5,30}$/).required()}),T={data:function(){return{errorMessage:"",loggingIn:!1,user:{email:"",password:""}}},filters:{filtermessage:function(e){return e.includes("Unexpected token")?"email and password do not match.":e}},methods:{signin:function(){var e=this;if(this.errorMessage="",this.validUser()){this.loggingIn=!0;var t={email:this.user.email,password:this.user.password};v.login(t).then((function(t){e.loggingIn=!1,e.$router.push("/dashboard")})).catch((function(t){e.loggingIn=!1,e.errorMessage=t.message}))}},validUser:function(){var e=x.a.validate(this.user,N);return null===e.error||(e.error.message.includes("email")?(this.errorMessage="email is invalid.",!1):(this.errorMessage="Password is invalid.",!1))}}},q=T,D=(r("7a9b"),Object(E["a"])(q,A,I,!1,null,null,null)),R=D.exports,z=function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("div",[e.errorMessage?r("div",{staticClass:"alert alert-danger",attrs:{role:"alert"}},[e._v("\n    "+e._s(e.errorMessage)+"\n  ")]):e._e(),r("h1",[e._v("Dashboard")]),r("h2",{staticClass:"my-3"},[e._v("Hello, "+e._s(this.name))]),r("button",{staticClass:"btn btn-primary",on:{click:function(t){return e.logout()}}},[e._v("Logout")])])},J=[],H=r("7dc8"),L=H.API_URL,B=L+"/secret",V={mounted:function(){var e=this;this.$route.params.error&&404===this.$route.params.error&&(this.errorMessage="Page Not Found"),fetch(B,{headers:{Authorization:"Bearer ".concat(v.currentUserValue.token),"content-type":"application/json"},cache:"no-store"}).then((function(e){return e.ok?e.json():e.json().then((function(e){throw new Error(e.error)}))})).then((function(t){e.name=t.secret})).catch((function(t){e.logout()}))},data:function(){return{errorMessage:"",name:""}},methods:{logout:function(){v.logout(),this.$router.push("/signin")}}},Z=V,F=Object(E["a"])(Z,z,J,!1,null,null,null),G=F.exports,K=function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("h1",[e._v("Member Page")])},Q=[],W={},X=W,Y=Object(E["a"])(X,K,Q,!1,null,null,null),ee=Y.exports,te=function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("h1",[e._v("Auditor Page")])},re=[],se={},ne=se,ae=Object(E["a"])(ne,te,re,!1,null,null,null),oe=ae.exports;s["a"].use(_["a"]);var ie=new _["a"]({mode:"history",routes:[{path:"/",redirect:"/signin"},{path:"/signin",name:"signin",component:R},{path:"/dashboard",name:"dashboard",component:G,meta:{authorize:[]}},{path:"/stats",name:"stats",component:ee,meta:{authorize:[y.MEMBER]}},{path:"/allocated",name:"allocated",component:oe,meta:{authorize:[y.AUDITOR]}},{path:"*",redirect:{name:"dashboard"}}]});ie.beforeEach((function(e,t,r){var s=e.meta.authorize,n=v.currentUserValue;if(s){if(!n)return r({path:"/signin",query:{returnUrl:e.path}});if(s.length&&!s.includes(n.role))return r({path:"/"})}else if("signin"===e.name&&n)return r({name:"dashboard"});r()}));var ue={name:"app",data:function(){return{currentUser:null}},created:function(){var e=this;v.currentUser.subscribe((function(t){return e.currentUser=t}))},computed:{isAuditor:function(){return this.currentUser&&this.currentUser.role===y.AUDITOR},isMember:function(){return this.currentUser&&this.currentUser.role===y.MEMBER}},methods:{logout:function(){v.logout(),ie.push("/signin")}}},le=ue,ce=Object(E["a"])(le,n,a,!1,null,null,null),de=ce.exports,me=r("2f62");s["a"].use(me["a"]);var pe=new me["a"].Store({state:{},mutations:{},actions:{}});s["a"].config.productionTip=!1,new s["a"]({router:ie,store:pe,render:function(e){return e(de)}}).$mount("#app")},"5c3d":function(e,t,r){e.exports=r.p+"img/spinner.8509c197.svg"},6:function(e,t){},7:function(e,t){},"7a9b":function(e,t,r){"use strict";var s=r("25d8"),n=r.n(s);n.a},"7dc8":function(e,t,r){"use strict";r.r(t),r.d(t,"API_URL",(function(){return s}));var s="http://localhost:3000/api/auth"},8:function(e,t){},9:function(e,t){}});
//# sourceMappingURL=app.0e161bf1.js.map